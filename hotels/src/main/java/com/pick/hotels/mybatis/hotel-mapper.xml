<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 이파일은 sql 명령만 보관하는파일  -->
<!-- 찾아올수 있도록 namespace 지정 -->
<mapper namespace="hotel">
	<insert id="regist" parameterType="hotelDto">
		insert into hotel values(
			#{hotel_no}, #{hotel_name}, #{hotel_tel}, #{hotel_zip_code}, 
			#{hotel_basic_addr}, #{hotel_detail_addr},#{hotel_longitude}, 
			#{hotel_latitude}, #{hotel_content}, #{hotel_star}, #{hotel_parking}, 
			#{hotel_fitness},#{hotel_pool}, #{hotel_sauna}, #{hotel_lounge}, 
			#{hotel_bbq},#{hotel_cafe}, #{hotel_convenience_store}, 
			#{hotel_karaoke}, #{hotel_internet},#{seller_no}, #{hotel_title}
		)
	</insert>
	
	<select id="list" parameterType="int" resultType="hotelDto">
		select * from hotel where seller_no = #{seller_no}
	</select>
	
	<select id="search_list" parameterType="h_search_vo" resultType="hotelListVo">
		select 
		h.hotel_no, H.hotel_name, H.hotel_tel, H.hotel_zip_code, H.hotel_basic_addr, H.hotel_title, H.hotel_star,H.hotel_parking, H.hotel_fitness,H.hotel_pool,H.hotel_sauna,H.hotel_lounge,H.hotel_bbq,H.hotel_cafe,H.hotel_convenience_store,H.hotel_karaoke,H.hotel_internet,
		count(R.room_name) room_cnt, min(R.room_price) min_price, max(R.room_price) max_price, max(R.room_people) max_people
		from 
		hotel H
		inner join Room R on H.hotel_no = R.hotel_no
		group by h.hotel_no, H.hotel_name, H.hotel_tel, H.hotel_zip_code, H.hotel_basic_addr, H.hotel_title, H.hotel_star,H.hotel_parking, H.hotel_fitness,
		                H.hotel_pool,H.hotel_sauna,H.hotel_lounge,H.hotel_bbq,H.hotel_cafe,H.hotel_convenience_store,H.hotel_karaoke,H.hotel_internet
		having
		H.hotel_basic_addr like '%' ||  #{region} || '%' and
		<if test="parking != null ">
		H.hotel_parking = 'Y' and
		</if>
		<if test="fitness != null">
		H.hotel_fitness = 'Y' and
		</if>
		<if test="pool != null">
		H.hotel_pool = 'Y' and
		</if>
		<if test="sauna != null ">
		H.hotel_sauna = 'Y' and
		</if>
		<if test="lounge != null">
		H.hotel_lounge = 'Y' and
		</if>
		<if test="bbq != null ">
		H.hotel_bbq = 'Y' and
		</if>
		<if test="cafe != null ">
		H.hotel_cafe = 'Y' and
		</if>
		<if test="conveni != null ">
		H.hotel_convenience_store = 'Y' and
		</if>
		<if test="karaoke != null ">
		H.hotel_karaoke = 'Y' and
		</if>
		<if test="internet != null ">
		H.hotel_internet = 'Y' and
		</if>
		max(R.room_people) >= #{people}
		order by max_price desc
	</select>
	
		<!-- 시퀀스 번호 -->
	<select id="seq" resultType="int">
		select hotel_seq.nextval from dual
	</select>
	
	<delete id="delete" parameterType="int">
		delete hotel where hotel_no = #{hotel_no}
	</delete>
	
	<select id="get" parameterType="int" resultType="hotelDto">
		select * from hotel where hotel_no = #{hotel_no}
 	</select>
 	
 		<!-- 호텔 수정 -->
	<update id="edit" parameterType="hotelDto">
		update hotel 
			set hotel_name = #{hotel_name}, hotel_tel=#{hotel_tel},hotel_zip_code = #{hotel_zip_code}, 
			hotel_basic_addr = #{hotel_basic_addr}, hotel_detail_addr = #{hotel_detail_addr}, 
			hotel_longitude = #{hotel_longitude}, hotel_latitude = #{hotel_latitude}, 
			hotel_content = #{hotel_content}, hotel_star = #{hotel_star}, hotel_parking = #{hotel_parking},
			hotel_fitness = #{hotel_fitness}, hotel_pool = #{hotel_pool}, hotel_sauna = #{hotel_sauna},
			hotel_lounge = #{hotel_lounge}, hotel_bbq = #{hotel_bbq}, hotel_cafe = #{hotel_cafe},
			hotel_convenience_store = #{hotel_convenience_store}, hotel_karaoke = #{hotel_karaoke}, 
			hotel_internet = #{hotel_internet}, hotel_title = #{hotel_title}
		where hotel_no = #{hotel_no}
	</update>
	
</mapper>